window.ZeroClipboard={version:"1.0.8",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(b){return typeof b=="string"&&(b=document.getElementById(b)),b.addClass||(b.hide=function(){this.style.display="none"},b.show=function(){this.style.display=""},b.addClass=function(c){this.removeClass(c),this.className+=" "+c},b.removeClass=function(f){var e=this.className.split(/\s+/),h=-1;for(var g=0;g<e.length;g++){e[g]==f&&(h=g,g=e.length)}return h>-1&&(e.splice(h,1),this.className=e.join(" ")),this},b.hasClass=function(c){return !!this.className.match(new RegExp("\\s*"+c+"\\s*"))}),b},setMoviePath:function(b){this.moviePath=b},newClient:function(){return new ZeroClipboard.Client},dispatch:function(f,e,h){var g=this.clients[f];g&&g.receiveEvent(e,h)},register:function(d,c){this.clients[d]=c},getDOMObjectPosition:function(e,d){var f={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};while(e&&e!=d){f.left+=e.offsetLeft,f.left+=e.style.borderLeftWidth?parseInt(e.style.borderLeftWidth):0,f.top+=e.offsetTop,f.top+=e.style.borderTopWidth?parseInt(e.style.borderTopWidth):0,e=e.offsetParent}return f},Client:function(b){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),b&&this.glue(b)}},ZeroClipboard.Client.prototype={id:0,title:"",ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,zIndex:99,glue:function(h,g,m){this.domElement=ZeroClipboard.$(h),this.domElement.style.zIndex&&(this.zIndex=parseInt(this.domElement.style.zIndex,10)+1),this.domElement.getAttribute("title")!=null&&(this.title=this.domElement.getAttribute("title")),typeof g=="string"?g=ZeroClipboard.$(g):typeof g=="undefined"&&(g=document.getElementsByTagName("body")[0]);var l=ZeroClipboard.getDOMObjectPosition(this.domElement,g);this.div=document.createElement("div");var k=this.div.style;k.position="absolute",k.left=""+l.left+"px",k.top=""+l.top+"px",k.width=""+l.width+"px",k.height=""+l.height+"px",k.zIndex=this.zIndex;if(typeof m=="object"){for(var j in m){k[j]=m[j]}}g.appendChild(this.div),this.div.innerHTML=this.getHTML(l.width,l.height)},getHTML:function(h,g){var m="",l="id="+this.id+"&width="+h+"&height="+g,k=this.title?' title="'+this.title+'"':"";if(navigator.userAgent.match(/MSIE/)){var j=location.href.match(/^https/i)?"https://":"http://";m+="<object"+k+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+j+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+h+'" height="'+g+'" id="'+this.movieId+'"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+l+'"/><param name="wmode" value="transparent"/></object>'}else{m+="<embed"+k+' id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+h+'" height="'+g+'" name="'+this.movieId+'" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+l+'" wmode="transparent" />'}return m},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var d=document.getElementsByTagName("body")[0];try{d.removeChild(this.div)}catch(c){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide());if(this.domElement&&this.div){var d=ZeroClipboard.getDOMObjectPosition(this.domElement),f=this.div.style;f.left=""+d.left+"px",f.top=""+d.top+"px"}},setText:function(b){this.clipText=b,this.ready&&this.movie.setText(b)},setTitle:function(b){this.title=b},addEventListener:function(d,c){d=d.toString().toLowerCase().replace(/^on/,""),this.handlers[d]||(this.handlers[d]=[]),this.handlers[d].push(c)},setHandCursor:function(b){this.handCursorEnabled=b,this.ready&&this.movie.setHandCursor(b)},setCSSEffects:function(b){this.cssEffects=!!b},receiveEvent:function(h,g){h=h.toString().toLowerCase().replace(/^on/,"");switch(h){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var m=this;setTimeout(function(){m.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var m=this;setTimeout(function(){m.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[h]){for(var l=0,k=this.handlers[h].length;l<k;l++){var j=this.handlers[h][l];typeof j=="function"?j(this,g):typeof j=="object"&&j.length==2?j[0][j[1]](this,g):typeof j=="string"&&window[j](this,g)}}}},typeof module!="undefined"&&(module.exports=ZeroClipboard);UserAgent={};UserAgent.searchPage=null;UserAgent.searchResultsPage=null;UserAgent.stylesPage=null;UserAgent.moodsPage=null;UserAgent.topPage=null;UserAgent.manualHistory=["#search"];UserAgent.miniWidth=null;UserAgent.changePage=function(b){var a=$("div.page,#permafooter").not(b);a.not(":eq(0)").fadeOut(200);a.first().fadeOut(200,function(){$(b).hide().fadeIn(200,function(){if(b!="#search_results"){$("#permafooter").show()}if(b=="#copydata"){if(!Output.clipboard){ZeroClipboard.setMoviePath("http://www.nickschaden.com/echospot/swf/ZeroClipboard.swf");Output.clipboard=new ZeroClipboard.Client();Output.clipboard.glue("clip_button","clip_container");Output.clipboard.addEventListener("onComplete",function(){$(".copy_success").addClass("active");setTimeout(function(){$(".copy_success").removeClass("active")},4000)});Output.clipboard.setText(Output.contentSongLinkRows.join("\n"))}else{Output.clipboard.setText(Output.contentSongLinkRows.join("\n"))}}})});if(b!="#search_results"&&b!="#copydata"){$("#permaheader").find(".csv_container,.spot_container").removeClass("active")}if(b=="#search"){$("#permaheader nav a.top").removeClass("active");if($("#search-byartist")[0].checked){$("#permaheader nav a.artist").addClass("active")}else{if($("#search-byplaylist")[0].checked){$("#permaheader nav a.playlist").addClass("active")}else{$("#permaheader nav a.song").addClass("active")}}}else{if(b=="#top"){$("#permaheader nav a").removeClass("active");$("#permaheader nav a.top").addClass("active")}}if(Modernizr.history){history.pushState({page:b},null,"");UserAgent.manualHistory.push(b)}};if(Modernizr.history){window.onpopstate=function(b){if(UserAgent.manualHistory.length>1){UserAgent.manualHistory.pop();var a=UserAgent.manualHistory.pop();UserAgent.changePage(a)}}}$(function(){UserAgent.miniWidth=($(window).width()<=480);var b=document.location.href.split("#");if(b.length>1&&b[1]!="top"&&b[1]!="search"){document.location.href=b[0]+"#search"}$("#permaheader").find("nav li a").click(function(){$this=$(this);if($this.hasClass("active")){return false}if($this.hasClass("playlist_generate")){$("#copydata").find("textarea").val(Output.contentSongLinkRows.join("\n"));UserAgent.changePage("#copydata")}else{if($this.hasClass("csv")){var c=Output.plainTextContentRows.join("\n");$("#save-csv input").val(c);$("#save-csv").submit()}else{if($("#help").length){if(Modernizr.sessionstorage){if($this.hasClass("playlist")){sessionStorage.setItem("startsearchsetting","playlist")}if($this.hasClass("artist")){sessionStorage.setItem("startsearchsetting","artist")}if($this.hasClass("song")){sessionStorage.setItem("startsearchsetting","song")}}document.location.href="/echospot"}if(!$("#search:visible").length&&!$this.hasClass("top")){UserAgent.changePage("#search")}$("#permaheader").find("nav li a").removeClass("active");$this.addClass("active");if($this.hasClass("artist")){$("#search-byartist").trigger("click")}if($this.hasClass("song")){$("#search-bysong").trigger("click")}if($this.hasClass("playlist")){$("#search-byplaylist").trigger("click")}if($this.hasClass("help")){document.location.href="/echospot/help.html"}if($this.hasClass("top")){UserAgent.changePage("#top")}else{$("#top:visible").fadeOut(200)}}}return false});if($("#help").length){return}EchoCheck.fetchTopTerms(false,function(c){Output.setOutputToPage($("#styles"));Output.addCheckboxesToPage(c.terms);EventHandler.addsearchCheckboxFunctionality("styles");$("#styles .content fieldset").addClass("checkbox_container").insertAfter($("#styles_container"));$("#search-styles").on("click",function(){$("#styles_container").next().toggle(200);return false});EchoCheck.fetchTopTerms(true,function(d){Output.setOutputToPage($("#moods"));Output.addCheckboxesToPage(d.terms);EventHandler.addsearchCheckboxFunctionality("moods");$("#moods .content fieldset").addClass("checkbox_container").insertAfter($("#moods_container"));$("#search-moods").on("click",function(){$("#moods_container").next().toggle(200);return false})})});$("#search").find("#search-byartist,#search-bysong").on("click",function(){$("#search").find(".playlistonly").addClass("inactive");$("#search").find(".hideonplaylist").removeClass("inactive");if($(this).attr("id")=="search-bysong"){$("#search-artist").siblings("label").text("Find artist/track")}else{$("#search-artist").siblings("label").text("Find artist")}if($(this).attr("id")=="search-bysong"){$("#search-hotness").siblings("label").text("Song hotness")}else{$("#search-hotness").siblings("label").text("Artist hotness")}if(Modernizr.sessionstorage){sessionStorage.setItem("startsearchsetting",$(this).attr("id").replace("search-by",""))}});$("#search").find("#search-byplaylist").on("click",function(){$("#search").find(".playlistonly").removeClass("inactive");$("#search").find(".hideonplaylist").addClass("inactive");$("#search-artist").siblings("label").text("Artist(s)/Spotify URI(s)");$("#search-hotness").siblings("label").text("Artist hotness");if(Modernizr.sessionstorage){sessionStorage.setItem("startsearchsetting","playlist")}});$("#search").find("input.reset").on("click",function(){$("#search-artist,#search-terms").removeClass("error").siblings(".errorlabel").remove();$("#search-artist").val("");Output.clearCheckboxesPage("styles");Output.clearCheckboxesPage("moods");$("#search-startyear")[0].selectedIndex=0;$("#search-endyear")[0].selectedIndex=0;$("#search-terms").val("");$("#search-playlisttype")[0].selectedIndex=0;$("#search-hotness")[0].selectedIndex=0;$("#search-songhotness")[0].selectedIndex=0;$("#search-familiarity")[0].selectedIndex=0;$("#search-sortby")[0].selectedIndex=0;$("#search-sortbyplaylist")[0].selectedIndex=0;$("#search-variety")[0].selectedIndex=2;$("#search-distribution")[0].selectedIndex=0;$("#search-mintempo").val("");$("#search-maxtempo").val("");$("#search-energy")[0].selectedIndex=0;$("#search-danceability")[0].selectedIndex=0;$("#search-results")[0].selectedIndex=1});$("#search").find("input.submit").on("click",function(){var d=$("#search");var j="artist";j=$.trim($("#permaheader .active").attr("class").replace("active",""));var n={};if(j=="song"){n.combined=jQuery.trim($("#search-artist").val())}else{n.artist=jQuery.trim($("#search-artist").val())}$("#search-artist,#search-terms").removeClass("error").siblings(".errorlabel").remove();if(j!="artist"){var c="";if(j!="playlist"||$("#search-playlisttype").val()!="artistdescription"){c="#search-artist"}else{c="#search-terms"}if(!$.trim($(c).val()).length){$(c).addClass("error").focus().after('<p class="errorlabel">Required field</p>');return}}else{if(!$.trim($("#search-artist").val()).length&&!$.trim($("#search-terms").val()).length){$("#search-artist,#search-terms").addClass("error").focus().after('<p class="errorlabel">Required field - artist or term</p>');return}}Output.setOutputToPage($("#search_results"));$("#permaheader nav a").removeClass("active");$("#search_results").addClass("loading");var e;e=Output.content.children();if(e.length){e.remove()}else{EventHandler.addArtistMenusFunctionality(Output.content)}UserAgent.changePage("#search_results");n.styles=$("#search-styles").text().replace("-","");n.moods=$("#search-moods").text().replace("-","");n.startyear=$("#search-startyear").val();if(n.startyear=="Start Year"){n.startyear=null}else{n.startyear=parseInt(n.startyear,10)-1}n.endyear=$("#search-endyear").val();if(n.endyear=="End Year"){n.endyear=null}else{n.endyear=parseInt(n.endyear,10)+1}n.description=jQuery.trim($("#search-terms").val());var k=$("#search-hotness").val();n.hotnessmin=0;n.hotnessmax=1;if(k=="high"){n.hotnessmin=0.7}if(k=="highaverage"){n.hotnessmin=0.3;n.hotnessmax=1}if(k=="average"){n.hotnessmin=0.3;n.hotnessmax=0.7}if(k=="lowaverage"){n.hotnessmin=0;n.hotnessmax=0.7}if(k=="low"){n.hotnessmax=0.3}var g=$("#search-familiarity").val();n.familiaritymin=0;n.familiaritymax=1;if(g=="wellknown"){n.familiaritymin=0.7}if(g=="wellknownaverage"){n.familiaritymin=0.3;n.familiaritymax=1}if(g=="average"){n.familiaritymin=0.3;n.familiaritymax=0.7}if(g=="obscureaverage"){n.familiaritymin=0;n.familiaritymax=0.7}if(g=="obscure"){n.familiaritymax=0.3}n.results=$("#search-results").val();n.sortby=$("#search-sortby").val();if(j=="song"){if(n.sortby=="hotness"){n.sortby="song_hotttnesss-desc"}else{n.sortby="artist_familiarity-desc"}}else{if(j=="artist"){if(n.sortby=="hotness"){n.sortby="hotttnesss-desc"}else{n.sortby="familiarity-desc"}}else{delete n.sortby}}if(j=="playlist"){n.playlisttype=$("#search-playlisttype").val();var m=$("#search-variety").val();n.variety=0.3;if(m=="very high"){n.variety=1}if(m=="high"){n.variety=0.6}if(m=="average"){n.variety=0.3}if(m=="low"){n.variety=0.1}n.distribution=$("#search-distribution").val();n.mintempo=$("#search-mintempo").val();n.maxtempo=$("#search-maxtempo").val();var f=$("#search-songhotness").val();n.songhotnessmin=0;n.songhotnessmax=1;if(f=="high"){n.songhotnessmin=0.7}if(f=="highaverage"){n.songhotnessmin=0.3;n.songhotnessmax=1}if(f=="average"){n.songhotnessmin=0.3;n.songhotnessmax=0.7}if(f=="lowaverage"){n.songhotnessmin=0;n.songhotnessmax=0.7}if(f=="low"){n.songhotnessmax=0.3}var l=$("#search-energy").val();n.energymin=0;n.energymax=1;if(l=="high"){n.energymin=0.7}if(l=="highaverage"){n.energymin=0.3;n.energymax=1}if(l=="average"){n.energymin=0.3;n.energymax=0.7}if(l=="lowaverage"){n.energymin=0;n.energymax=0.7}if(l=="low"){n.energymax=0.3}var h=$("#search-danceability").val();n.danceabilitymin=0;n.danceabilitymax=1;if(h=="high"){n.danceabilitymin=0.7}if(h=="highaverage"){n.danceabilitymin=0.3;n.danceabilitymax=1}if(h=="average"){n.danceabilitymin=0.3;n.danceabilitymax=0.7}if(h=="lowaverage"){n.danceabilitymin=0;n.danceabilitymax=0.7}if(h=="low"){n.danceabilitymax=0.3}n.sortbyplaylist=$("#search-sortbyplaylist").val()}EventHandler.addArtistMenusFunctionality(Output.content);EchoCheck.powerSearch(j,n,function(o){$("#search_results").removeClass("loading");$("#permaheader").find(".csv_container,.spot_container").addClass("active");if(j=="artist"){Output.addArtistsToPage(o.artists,$("#search-sortby").val());if(!o.artists.length){Output.saveArtistRow("No artists found");Output.addContentRows()}}else{if(j=="song"||j=="playlist"){if(!o.songs.length){Output.saveSongRow("No songs found");Output.addContentRows()}else{if(j=="song"){Output.addSongsToPage(o.songs,$("#search-sortby").val())}else{Output.addSongsToPage(o.songs,$("#search-sortbyplaylist").val(),n)}}}}Output.content.trigger("create");$("#permafooter").show()})});$("#search-artist").on("keypress",function(c){if(c.keyCode==13&&!c.ctrlKey&&!c.shiftKey&&!c.altKey){$("#search").find("input.submit").trigger("click")}});if(Modernizr.sessionstorage&&!$("#help").length){var a=sessionStorage.getItem("startsearchsetting");if(a=="song"){$("#search-byartist").prop("checked",false);$("#search-bysong").trigger("click").prop("checked",true);$("#permaheader").find("nav li a").removeClass("active");$("#permaheader a.song").addClass("active")}if(a=="playlist"){$("#search-byartist").prop("checked",false);$("#search-byplaylist").trigger("click").prop("checked",true);$("#permaheader").find("nav li a").removeClass("active");$("#permaheader a.playlist").addClass("active")}if(a=="artist"){$("#search-byartist").trigger("click").prop("checked",true);$("#permaheader").find("nav li a").removeClass("active");$("#permaheader a.artist").addClass("active")}}EventHandler.addsearchCheckboxFunctionality("styles");EventHandler.addsearchCheckboxFunctionality("moods");Output.setOutputToPage($("#top"));EventHandler.addArtistMenusFunctionality(Output.content);EchoCheck.fetchTopHotArtists(40,function(c){Output.setOutputToPage($("#top"));Output.addArtistsToPage(c.artists);Output.content.trigger("create")})});EchoCheck={api:"PWNYOEPUNHQTGZLHY",base:"http://developer.echonest.com/api/v4/",callJSON:function(a,c,b){$.ajax({url:a,dataType:"json",data:c,success:function(d){if(EchoCheck.checkResponse(d)){if(typeof b=="function"){b(d.response)}}},error:function(e,d){if(Output.currentId=="search_results"){$("#search_results").removeClass("loading");Output.saveArtistRow("Unexpected error from server.");Output.addContentRows()}else{Output.setOutputToPage($("#search_results"));$("#search_results").removeClass("loading");Output.saveArtistRow("Unexpected error from server.");Output.addContentRows();UserAgent.changePage("#search_results")}},timeout:4000})},checkResponse:function(a){if(a.response){if(a.response.status.code!==0){if(Output.currentId=="search_results"){$("#search_results").removeClass("loading");Output.saveArtistRow("Unexpected error from server. "+a.response.status.message);Output.addContentRows()}else{Output.setOutputToPage($("#search_results"));$("#search_results").removeClass("loading");Output.saveArtistRow("Unexpected error from server. "+a.response.status.message);Output.addContentRows();UserAgent.changePage("#search_results")}}else{return true}}else{if(Output.currentId=="search_results"){Output.saveArtistRow("Unexpected error from server.");Output.addContentRows()}else{Output.setOutputToPage($("#search_results"));Output.saveArtistRow("Unexpected error from server. "+a.response.status.message);Output.addContentRows();UserAgent.changePage("#search_results")}}return false},findRelatedArtists:function(c,b,e){if(typeof c!="string"){return}var a=this.base+"artist/similar?callback=?&bucket=id:spotify-WW&bucket=hotttnesss&bucket=familiarity&bucket=terms";var d={format:"jsonp",api_key:this.api,limit:true,start:0,results:30};if(b){d.name=c}else{d.id=c}this.callJSON(a,d,e)},fetchTopTerms:function(a,d){if(typeof a!="boolean"&&typeof a!="undefined"){return}var b=this.base+"artist/list_terms?callback=?";var c=(a)?"mood":"style";this.callJSON(b,{format:"jsonp",api_key:this.api,type:c},d)},fetchTopHotArtists:function(b,c){if(typeof b!="number"){return}var a=this.base+"artist/top_hottt?callback=?&bucket=id:spotify-WW&bucket=hotttnesss&bucket=familiarity&bucket=terms";this.callJSON(a,{format:"jsonp",api_key:this.api,limit:true,results:b},c)},powerSearch:function(e,k,h){if(typeof e!="string"||typeof k!="object"){return}var a=this.base+"artist/search?callback=?&bucket=id:spotify-WW&bucket=hotttnesss&bucket=familiarity&bucket=terms";if(e=="song"){a=this.base+"song/search?callback=?&bucket=id:spotify-WW&bucket=tracks&bucket=song_hotttnesss&bucket=artist_hotttnesss&bucket=audio_summary&bucket=artist_familiarity"}else{if(e=="playlist"){a=this.base+"playlist/static?callback=?&bucket=id:spotify-WW&bucket=tracks&bucket=song_hotttnesss&bucket=artist_hotttnesss&bucket=audio_summary&bucket=artist_familiarity";if(k.description&&k.playlisttype&&k.playlisttype=="artistdescription"){var g=k.description.split(",");for(var d=0;d<g.length;d++){a+="&description="+jQuery.trim(g[d])}}else{if(k.artist&&k.playlisttype&&(k.playlisttype=="artistradio"||k.playlisttype=="artist"||k.playlisttype=="songradio")){var b=k.artist.split(",");for(var c=0;c<b.length;c++){if(b[c].indexOf("spotify:artist")>-1){a+="&artist_id=spotify-WW:"+jQuery.trim(b[c].replace("spotify:",""))}else{if(b[c].indexOf("spotify:track")>-1){a+="&track_id=spotify-WW:"+jQuery.trim(b[c].replace("spotify:",""))}else{a+="&artist="+jQuery.trim(b[c])}}}}}}}var f={format:"jsonp",api_key:this.api,sort:"hotttnesss-desc",limit:true,results:50,min_hotttnesss:0.1};if(k.artist&&e=="artist"){delete f.min_hotttnesss;f.name=k.artist}else{if(e=="song"&&k.combined){f.combined=k.combined}if(k.styles){f.style=k.styles}if(k.moods){f.mood=k.moods}if(k.description&&e!="playlist"){f.description=k.description}if(e=="song"){delete f.min_hotttnesss;if(k.hotnessmin||k.hotnessmin===0){f.song_min_hotttnesss=k.hotnessmin}if(k.hotnessmax){f.song_max_hotttnesss=k.hotnessmax}}else{if(e=="playlist"){delete f.min_hotttnesss;if(k.hotnessmin||k.hotnessmin===0){f.artist_min_hotttnesss=k.hotnessmin}if(k.hotnessmax){f.artist_max_hotttnesss=k.hotnessmax}}else{if(k.hotnessmin||k.hotnessmin===0){f.min_hotttnesss=k.hotnessmin}if(k.hotnessmax){f.max_hotttnesss=k.hotnessmax}}}if(e=="song"||e=="playlist"){if(k.familiaritymin||k.familiaritymin===0){f.artist_min_familiarity=k.familiaritymin}if(k.familiaritymax){f.artist_max_familiarity=k.familiaritymax}}else{if(k.familiaritymin||k.familiaritymin===0){f.min_familiarity=k.familiaritymin}if(k.familiaritymax){f.max_familiarity=k.familiaritymax}}if(k.startyear){f.artist_end_year_after=k.startyear}if(k.endyear){f.artist_start_year_before=k.endyear}if(e=="song"){f.sort="song_hotttnesss-desc"}if(k.sortby){f.sort=k.sortby}if(k.results){f.results=k.results}if(e=="playlist"){delete f.sort;if(k.playlisttype&&k.playlisttype=="artistdescription"){delete f.artist;f.type="artist-description"}else{delete f.description;if(k.playlisttype=="songradio"){f.type="song-radio"}else{if(k.playlisttype=="artist"){f.type="artist"}else{f.type="artist-radio"}}}if(k.variety){f.variety=k.variety}if(k.mintempo){f.min_tempo=k.mintempo}if(k.maxtempo){f.max_tempo=k.maxtempo}if(k.distribution){f.distribution=k.distribution}if(k.songhotnessmin||k.songhotnessmin===0){f.song_min_hotttnesss=k.songhotnessmin}if(k.songhotnessmax){f.song_max_hotttnesss=k.songhotnessmax}if(k.energymin||k.energymin===0){f.min_energy=k.energymin}if(k.energymax){f.max_energy=k.energymax}if(k.danceabilitymin||k.danceabilitymin===0){f.min_danceability=k.danceabilitymin}if(k.danceabilitymax){f.max_danceability=k.danceabilitymax}if(k.sortbyplaylist&&k.sortbyplaylist!="random"){f.sort=k.sortbyplaylist}}}this.callJSON(a,f,h)}};Output={artistDetail:{},clipboard:null,colorSpectrumLength:10,colorSpectrumIndex:0,content:null,contentId:"",contentRows:[],contentSongLinkRows:[],footerContent:'<div class="footer"><div><ul><li><a class="search" href="#search">Search</a></li><li><a class="top" href="#top">Top</a></li></ul></div></div>',plainTextContentRows:[],songDetail:{},addRow:function(a){this.content.append("<div><h3>"+a+"</h3></div>").trigger("create");this.colorSpectrumLengthIndex++},addContentRows:function(a){if(!a){this.content.append(this.contentRows.join("")).trigger("create")}else{a.append(this.contentRows.join("")).trigger("create")}this.contentRows=[]},addArtistsToPage:function(a,g){for(var c=0;c<a.length;c++){var e=a[c];var d=Output.artistDetail[e.name];if(typeof d=="undefined"){Output.artistDetail[e.name]={echoid:e.id,spotlink:null,terms:null};d=Output.artistDetail[e.name]}else{d.echoid=e.id}d[this.contentId+"_order"]=c;var f=[];for(var b=0;b<e.terms.length;b++){f.push(e.terms[b].name)}d.terms=f;var h="#";if(typeof e.foreign_ids=="object"&&typeof e.foreign_ids[0]=="object"){h="spotify://"+e.foreign_ids[0].foreign_id.replace("spotify-WW:","")}Output.saveArtistRow(e.name,e.hotttnesss,e.familiarity,f,h)}if(typeof g=="string"){Output.sortOutput(g,false)}Output.addContentRows()},addCheckboxesToPage:function(d){var e=Output.content.find("fieldset");if(!e.length){return}var b="";for(var c=0;c<d.length;c++){var a=d[c].name.replace(/(\s)+/,"_");b+='<input type="checkbox" name="style-'+a+'" id="style-'+a+'" class="custom" />';b+='<label for="style-'+a+'">'+d[c].name+"</label>"}e.append(b);Output.content.trigger("create")},addNewPage:function(d,c,a){if(typeof d!="string"||typeof c!="string"){return}d=d.replace(/\s+/g,"_");var b='<div class="page" id="'+d+'" class="'+a+'"><div class="header"><h2>'+c+'</h2></div><div class="content"></div>';$("#permafooter").before(b)},addSongsToPage:function(f,e,a){for(var b=0;b<f.length;b++){var d=f[b];var c=Output.songDetail[d.title];if(typeof c=="undefined"){Output.songDetail[d.title]={echoartistid:d.artist_id,echosongid:d.id,spotlink:null};c=Output.songDetail[d.title]}else{c.id=d.id;c.artist_id=d.artist_id}c[this.contentId+"_order"]=b;var g="#";if(typeof d.tracks=="object"&&typeof d.tracks[0]=="object"){g="spotify://"+d.tracks[0].foreign_id.replace("spotify-WW:","")}if(typeof a!="object"||Output.filterOutput(d,a)){Output.saveSongRow(d.title,d.artist_name,d.song_hotttnesss,d.artist_hotttnesss,d.artist_familiarity,d.audio_summary.danceability,d.audio_summary.energy,d.audio_summary.tempo,g)}}if(typeof e=="string"&&e!="random"){Output.sortOutput(e,true)}Output.addContentRows();if(UserAgent.miniWidth){$("#search_results").click(function(j){j.preventDefault();if(j.target.tagName=="H3"){var h=$(j.target).siblings("ul").find("a");if(h.length){document.location.href=h.attr("href")}}})}},addSpotifyLinkToArtistRow:function(c,b){var a=this.content.children().eq(b);if(!a.length){return}var d;d=a.find("ul");d.prepend('<li><a href="'+c+">Spotify Link</a></li>").trigger("create")},addSpotifyLinkToSongRow:function(c,b){var a=this.content.children().eq(b);if(!a.length){return}var d;d=a.find("ul");d.prepend('<li><a href="'+c+">Spotify Link</a></li>").trigger("create")},clearCheckboxesPage:function(a){var b=$("#search").find("input").filter(":checked");b.prop("checked",false);$("#search-"+a).text("-")},saveArtistRow:function(a,e,d,b,c){var f;f='<div class="artistrow"><h3>'+a+"</h3>";this.colorSpectrumIndex++;if(typeof e=="undefined"){f+="</div>"}else{f+="<ul>";if(UserAgent.miniWidth){f+='<li><a href="'+c+'">Spotify Link</a></li><li>H: '+Math.round(e*100)+"%</li><li>F: "+Math.round(d*100)+"%</li>"}else{f+='<li><a href="'+c+'">Spotify Link</a></li><li>Hotness: '+Math.round(e*100)+"%</li><li>Familiarity: "+Math.round(d*100)+"%</li>"}this.artistDetail[a].terms=b;f+="</ul></div>"}this.contentRows.push(f);this.plainTextContentRows.push('"'+a+'"')},saveSongRow:function(k,h,d,c,g,f,l,e,j){var b;var a=Math.floor(this.colorSpectrumIndex/this.colorSpectrumLength)%2?(this.colorSpectrumIndex%this.colorSpectrumLength):this.colorSpectrumLength-(this.colorSpectrumIndex%this.colorSpectrumLength);if(typeof h=="undefined"){b='<div class="songrow"><h3>'+k+"</h3>"}else{b='<div class="songrow"><h3>'+k+" - "+h+"</h3>"}this.colorSpectrumIndex++;if(typeof h=="undefined"){b+="</div>"}else{b+="<ul>";b+='<li><a href="'+j+'">Spotify Link</a></li>';b+="<li>SH: "+Math.round(d*100)+"%</li><li>AH: "+Math.round(c*100)+"%</li>";b+="<li>AF: "+Math.round(g*100)+"%</li><li>D: "+Math.round(f*100)+"%</li>";if(!UserAgent.miniWidth){b+="<li>E: "+Math.round(l*100)+'%</li><li class="last">T: '+e+"</li>"}b+="</ul></div>"}this.contentRows.push(b);this.plainTextContentRows.push('"'+k+'","'+h+'"');this.contentSongLinkRows.push(j)},setOutputToPage:function(b){if(typeof b!="object"){return}var a=$(b).find(".content");if(!a.length){return}this.contentId=b.attr("id");this.contentRows=[];this.contentSongLinkRows=[];if(b.attr("id")=="search_results"){if(Modernizr.sessionstorage&&sessionStorage.getItem("startsearchsetting")=="artist"){this.plainTextContentRows=['"Artist"']}else{if(Modernizr.sessionstorage&&sessionStorage.getItem("startsearchsetting")=="song"){this.plainTextContentRows=['"Song"']}else{this.plainTextContentRows=['"Song","Artist"']}}}else{this.plainTextContentRows=['"Artist"']}this.content=a;this.colorSpectrumIndex=0},filterOutput:function(b,a){return((b.artist_familiarity>=a.familiaritymin)&&(b.artist_familiarity<=a.familiaritymax)&&(b.artist_hotttnesss>=a.hotnessmin)&&(b.artist_hotttnesss<=a.hotnessmax)&&(b.audio_summary.danceability>=a.danceabilitymin)&&(b.audio_summary.danceability<=a.danceabilitymax)&&(b.audio_summary.energy>=a.energymin)&&(b.audio_summary.energy<=a.energymax)&&(a.mintempo.length===0||b.audio_summary.tempo>=a.mintempo)&&(a.maxtempo.length===0||b.audio_summary.tempo<=a.maxtempo)&&(b.song_hotttnesss>=a.songhotnessmin)&&(b.song_hotttnesss<=a.songhotnessmax))},sortOutput:function(h,g){var d=true;if(g){if(h.indexOf("asc")>-1){d=false}if(h.indexOf("song_hotttnesss")>-1||h.indexOf("hotness")>-1){h="SH"}if(h.indexOf("artist_hotttnesss")>-1){h="AH"}if(h.indexOf("artist_familiarity")>-1||h.indexOf("familiarity")>-1){h="AF"}if(h.indexOf("tempo")>-1){h="T"}if(h.indexOf("danceability")>-1){h="D"}if(h.indexOf("energy")>-1){h="E"}}var f=new RegExp(">"+h+": (\\d)+","i");Output.contentRows.sort(function(k,j){var o=k.match(f);var m=j.match(f);if(!o||!m){return 1}var n=parseFloat(o[0].match(/\d+/)[0],10);var l=parseFloat(m[0].match(/\d+/)[0],10);return d?l-n:n-l});g=(Output.contentRows[0].match(/<h3>(.*)<\/h3>/)[1].indexOf("-")>-1);if(g){Output.plainTextContentRows=["Artist,Song"]}else{Output.plainTextContentRows=["Artist"]}Output.contentSongLinkRows=[];for(i=0;i<Output.contentRows.length;i++){var c=Output.contentRows[i].match(/<h3>(.*)<\/h3>/)[1];if(g){var e=Output.contentRows[i].match(/<a href="(.*)">Spotify/)[1];var b=$.trim(c.match(/-(.*)/)[1]);var a=$.trim(c.match(/-(.*)/)[1]);Output.plainTextContentRows.push('"'+b+'","'+a+'"');Output.contentSongLinkRows.push(e)}else{Output.plainTextContentRows.push('"'+c+'"')}}}};EventHandler={addArtistMenusFunctionality:function(a){var c="click";var b=".ui-collapsible-heading a";c="mouseover";b="div.artistrow,div.songrow";a.on(c,b,function(){$this=$(this);if(!$this.find("a.terms_link:visible").length){var g;g=$this;if(!g.find("a.terms_link").length){var h;h=jQuery.trim($this.find("h3").html().replace(/<span(.*)<\/span>/,""));var e=Output.artistDetail[h];if(typeof e=="object"){var d;d=g.find("ul");var j=d.html();var f="<ul>"+j+'<li><a class="terms_link" href="#">Terms</a></li>';f+='<li class="last"><a class="related_link" href="#">Related artists</a></li></ul>';d.replaceWith(f);g.trigger("create")}g.on("click","a.terms_link",function(){$("#permaheader").find("nav a.top").removeClass("active");var m=h.replace(/\s+/g,"")+"_terms";if(!$("#"+m).length){Output.addNewPage(m,h+" terms","terms");Output.setOutputToPage($("#"+m));var l="<ul>";for(var k=0;k<e.terms.length;k++){l+='<li class="termsrow"><a href="#search">'+e.terms[k]+"</a></li>"}l+="</ul>";Output.content.append(l).trigger("create");UserAgent.changePage("#"+m);$("#"+m).on("click","a",function(){$("#search-terms").val(jQuery.trim($(this).text()));UserAgent.changePage("#search");$("#permaheader nav a.artist").trigger("click");return false})}else{UserAgent.changePage("#"+m)}return false});g.on("click","a.related_link",function(){$("#permaheader").find("nav a.top").removeClass("active");var k=h.replace(/\s+/g,"")+"_related";if(!$("#"+k).length){Output.addNewPage(k,h+" related artists","related");Output.setOutputToPage($("#"+k));EventHandler.addArtistMenusFunctionality(Output.content);UserAgent.changePage("#"+k);$("#"+k).addClass("loading");$("#permafooter").css("visibility","hidden");EchoCheck.findRelatedArtists(e.echoid,false,function(l){Output.addArtistsToPage(l.artists);$("#permafooter").css("visibility","visible");$("#"+k).removeClass("loading")});return false}else{UserAgent.changePage("#"+k)}})}$this.find("a.terms_link,a.related_link").parent().show()}})},addsearchCheckboxFunctionality:function(a){var c=$("#"+a).find("fieldset");if(!c.length){return}var b;b="label";c.find(b).click(function(){var d;d=$(this).prev().attr("name").replace("style-","").replace("_"," ");var f;f=$("#search-"+a);var e=jQuery.trim(f.text());if(this.checked||(!$(this).prev()[0].checked)){if(e=="-"){e=d}else{e+=", "+d}}else{e=e.replace(", "+d,"").replace(d+",","").replace(d,"");if(e===""){e="-"}}f.text(e)})}};